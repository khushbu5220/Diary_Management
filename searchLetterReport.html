<!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
      <!-- Font Awesome -->
      
      <!-- <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet">   
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script> -->
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
      <link rel="stylesheet" href="https://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
      <script type="text/javascript" src="https://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
      <link rel="stylesheet" href="style.css">

      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
       integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" 
       crossorigin="anonymous" referrerpolicy="no-referrer" />      
       <script src="./js/index.js"></script>
       
    </head>
    <body class="loginpage">
      <div id="loading"></div>

      <header>
       
    <!-- bloc-0 -->
    <div class="bloc none full-width-bloc l-bloc " id="bloc-0">
      <div class="container bloc-lg bloc-sm-lg">
        <div class="row">
          <div class="col-12 col-md-2 col-lg-2 heading">
            <a target="_blank"><img style="height: 110px;" src="img/CSIR-Logo-With-Tagline-Seleceted-Bilingual-01.png" class="img-fluid float-lg-none" alt="CSIR Logo-With-Tagline-Seleceted-Bilingual-01" /></a>
          </div>
          <div class="col-12 offset-lg--1 col-lg-8 col-md-8 heading" id="heading">
            <h5 class="text-lg-center tc-black text-md-center">
              वैज्ञानिक तथा औद्योगिक अनुसंधान परिषद्</h5>
              <h5 class="text-lg-center tc-black text-md-center">
              Council of Scientific and Industrial Research</h5>
              <h5 class="text-lg-center tc-black text-md-center" id="heading2">
              विज्ञान और प्रौद्योगिकी मंत्रालय</h5>
              <h5 class="text-lg-center tc-black text-md-center" id="heading2">
              Ministry of Science and Technology, Govt. of India</h5>
          </div>
          <div class="col-12 col-lg-2 col-md-2 heading">
            <a target="_blank"><img  src="img/G20%20theme%20and%20logo.png" class="img-fluid img-style float-lg-right" alt="G20%20theme%20and%20logo" /></a>
          </div>
        </div>
      </div>
    </div>
    <!-- bloc-0 END -->
    
    <!-- Header start -->
    <nav style="height: 35px;">
        <div class="nav-adj"></div>
        <ul class="navbar" id="navbar">
        </ul>
      </nav>
    <!-- bloc-0 END -->
             
      </header>
    
    
    
    <div class="container mt-3">
      <div class="form-header-bg">
        <h2 class="form-header">Search Letter Diary</h2>
      </div>
      <form> 
        <div class="row user-form">

        

             <div class="row user-form">
                <div class="col-sm-6 user-record-form">
               <label class="form-label">New Letter Number</label>
                  <input type="text" id="letter_no" class="form-control" placeholder="Enter your New Letter Number">
                </div>
                <div class="col-sm-6 user-record-form">
                      <label class="form-label">Reference Number</label>
                  <input type="text" id="referenceNo" class="form-control" placeholder="Enter your Reference Number">
                </div>
              </div>
              <div class="row user-form">
                <div class="col-sm-6 user-record-form">
               <label class="form-label">Received From</label>
               <select id="recievedFrom" class="form-select"></select>
               <select id="designationdd" class="form-select" style="display: none;"></select>
               <select id="divisiondd" class="form-select" style="display: none;"></select>
                </div>
                <div class="col-sm-6 user-record-form">
                      <label class="form-label">Subject</label>
                  <input type="text" id="subject" class="form-control" placeholder="Enter your Subject">
                </div>
              </div>
              <div class="row user-form">
                <div class="col-sm-6 user-record-form">
               <label class="form-label">From Date</label>
                  <input type="date" id="from_date" class="form-control" placeholder="Enter your From Date">
                </div>
                <div class="col-sm-6 user-record-form">
                      <label class="form-label">To Date</label>
                  <input type="date" id="to_date" class="form-control" placeholder="Enter your To Date">
                </div>
              </div>
    

      
        </div>

        
          <div class="container">
            
            <!-- <div class="button-container">
              <button type="button" class="btn btn-primary">Search</button>
              
            </div> -->

            <div class="button-container">
              <button type="button" class="btn btn-primary" onclick="ListFunc()">Search</button>
              <button type="button" class="btn btn-primary" onclick="history.go(-1)">Cancel</button>
            </div>






          </div>
          <br>

          

          <div class="container">
            <!-- <div class="row header" style="text-align:center;color:green">
            <h3>Bootstrap table with pagination</h3> -->
            </div>
            <table id="example" class="table table-striped table-bordered" style="width:100%">   
                <thead>
                <tr>
                  <th class="th-sm">New Letter Diary
            
                  </th>
                  <th class="th-sm">Received From
            
                  </th>
                  <th class="th-sm">File References
            
                  </th>
                  <th class="th-sm">Subject
            
                  </th>
                  <th class="th-sm">Received Date
            
                  </th>
                  <th class="th-sm">Send To Designation
            
                  </th>
                  <th class="th-sm">Send To Division
            
                  </th>
                  <th class="th-sm">Send Date
            
                  </th>
                  <th class="th-sm">Remark
            
                  </th>
                  <th class="th-sm">
            
                  </th>
                </tr>
              </thead>
              <tbody id="tbody">
                
                
              </tbody>
              
            </table>
            </div>





      </form>
    </div>
    <script>
      $(document).ready(function() {
      $('#example').DataTable();
      });
      </script>
     <script>
      $(document).ready(function() {
      $('#example').DataTable();
      });

      function ListFunc()
      {
        console.log("************")
        event.preventDefault()
        const letterNo = document.getElementById("letter_no").value;
        const referenceNo = document.getElementById("referenceNo").value;
        const recievedFrom = document.getElementById("recievedFrom").value;
        const subject = document.getElementById("subject").value;
        const fromDate = document.getElementById("from_date").value;
        const toDate = document.getElementById("to_date").value;

        let xhr = new XMLHttpRequest();
        xhr.open("POST", "http://localhost:8080/searchLetterDiary", true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.setRequestHeader('Authorization', 'Bearer '+sessionStorage.getItem("token"));
        xhr.setRequestHeader('Access-Control-Allow-Origin', "*");
        xhr.onreadystatechange = function() {
            if(xhr.readyState === XMLHttpRequest.DONE) {
                if(xhr.status === 200) 
                {
                    console.log(xhr.responseText);
                    const jsonData = JSON.parse(xhr.responseText);
                    console.log("jsonData : "+ jsonData)
                    var text ="";
                    for(let i =0; i<jsonData.length; i++)
                    {
                      text += "<tr><td>"+jsonData[i].letter_number+"</td><td>"+jsonData[i].received_from+"</td><td>"+jsonData[i].refrence_no
                          +"</td><td>"+jsonData[i].subject+"</td><td>"+jsonData[i].received_date+"</td><td>"
                          +jsonData[i].send_to_designation+"</td><td>"+jsonData[i].send_to_designation+"</td><td>"+jsonData[i].cdt+"</td>"
                          +"<td>"+jsonData[i].remarks+"</td><td><button id='"+jsonData[i].id+"' class='btn btn-primary' onclick='viewfunction(this.id)'>View</button>"
                          +"<button id='"+jsonData[i].id+"' onclick='editfunction(this.id)' class='btn btn-primary'>Edit</button></td></tr>";
                    }
                    console.log(text)
                    document.getElementById("tbody").innerHTML =text;
                    
                }
                else 
                {
                    // document.getElementById("messageReponse").innerHTML = "Something went wrong, please try after sometime";
                    // console.error(xhr.responseText);
                    // window.location = "loginpage.html"
                }
            }
        };

      var data = {
        letter_no: letterNo,
        reference_no: referenceNo,
        received_from: recievedFrom,
        subject: subject,
        from_date: fromDate,
        to_date: toDate
      };

      xhr.send(JSON.stringify(data))

        function viewfunction(id)
        {
          sessionStorage.setItem("Id", id);
          window.location = "viewLetterDiary.html";
        }
        function editfunction(id)
        {
          sessionStorage.setItem("Id", id);
          window.location = "editLetterDiary.html";
        }
      }
      
      </script>
    </body>
    </html>
    