<!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
      <link rel="stylesheet" href="style.css">
      <script src="./js/index.js"></script>
    </head>
    <!-- Main container -->
<div class="page-container">
    
  <!-- bloc-0 -->
  
    <!-- bloc-0 -->
    <div class="bloc none full-width-bloc l-bloc " id="bloc-0">
      <div class="container bloc-lg bloc-sm-lg">
        <div class="row">
          <div class="col-12 col-md-2 col-lg-2 heading">
            <a target="_blank"><img style="height: 110px;" src="img/CSIR-Logo-With-Tagline-Seleceted-Bilingual-01.png" class="img-fluid float-lg-none" alt="CSIR Logo-With-Tagline-Seleceted-Bilingual-01" /></a>
          </div>
          <div class="col-12 offset-lg--1 col-lg-8 col-md-8 heading" id="heading">
            <h5 class="text-lg-center tc-black text-md-center">
              वैज्ञानिक तथा औद्योगिक अनुसंधान परिषद्</h5>
              <h5 class="text-lg-center tc-black text-md-center">
              Council of Scientific and Industrial Research</h5>
              <h5 class="text-lg-center tc-black text-md-center" id="heading2">
              विज्ञान और प्रौद्योगिकी मंत्रालय</h5>
              <h5 class="text-lg-center tc-black text-md-center" id="heading2">
              Ministry of Science and Technology, Govt. of India</h5>
          </div>
          <div class="col-12 col-lg-2 col-md-2 heading">
            <a target="_blank"><img  src="img/G20%20theme%20and%20logo.png" class="img-fluid img-style float-lg-right" alt="G20%20theme%20and%20logo" /></a>
          </div>
        </div>
      </div>
    </div>
    <!-- bloc-0 END -->
    
    <!-- Header start -->
    <nav style="height: 35px;">
        <div class="nav-adj"></div>
        <ul class="navbar" id="navbar">
        </ul>
      </nav>
    <!-- bloc-0 END -->
  <!-- bloc-0 END -->
    <body class="loginpage">
      <div id="loading"></div>


    
      
      <div class="container mt-3">
        <div class="form-header-bg">
            <h2 class="form-header">View File Diary</h2>
        </div>
        
        <div><span id="messageReponse"></span></div>
          <div style="display: none;"><input disabled id="id"></div>
        <div class="row user-form">
               

             <div class="row user-form">
                <div class="col-sm-6 user-record-form">
               <label class="form-label">New File Number</label>
                  <input type="text" disabled id="newFileNo" class="form-control" placeholder="Enter your New File Number">
                </div>
                <div class="col-sm-6 user-record-form">
                      <label class="form-label">Received From</label>
                  <input type="text" disabled id="recievedFrom" class="form-control" placeholder="Enter your Received From">
                </div>
              </div>
    
              <div class="row user-form">
                <div class="col-sm-6 user-record-form">
               <label class="form-label">Reference Number</label>
                  <input type="text" disabled id="referenceNo" class="form-control" placeholder="Enter your Reference Number">
                </div>
                <div class="col-sm-6 user-record-form">
                      <label class="form-label">Subject</label>
                  <input type="text" disabled id="subject" class="form-control" placeholder="Enter your Subject">
                </div>
              </div>

              <div class="row user-form">
                <div class="col-sm-6 user-record-form">
               <label class="form-label">Received Date</label>
                  <input type="text" disabled id="recievedDate" class="form-control" placeholder="Enter your Received Date">
                </div>
                <div class="col-sm-6 user-record-form">
                  <label class="form-label">Send To</label>
                    <input type="text" disabled class="form-control" id="designation">
                    </select>
                </div>
              </div>

              <div class="row user-form">
                <div class="col-sm-6 user-record-form">
               
                </div>
                <div class="col-sm-6 user-record-form">
                    <label class="form-label"></label>
                      <input type="text" disabled class="form-control" id="division">                       
                      </select>
                </div>
              </div>

              <div class="row user-form">
                <div class="col-sm-6 user-record-form">
               <label class="form-label">Send Date</label>
                  <input type="date" disabled id="fileDate" class="form-control" placeholder="Enter your Send Date">
                </div>
                <div class="col-sm-6 user-record-form">
                      <label class="form-label">Remark</label>
                  <input type="text" disabled id="remark" class="form-control" placeholder="Enter your Remark">
                </div>
              </div>
            <hr>

             <!-- status btn container start-->
             <div class="button-container">
              <button type="button" class="btn btn-primary" onclick="document.getElementById('updatestatus').style.display = 'block'">Update Status</button>                 
              <button type="button" class="btn btn-primary" onclick="document.getElementById('sendtoperson').style.display = 'block'">Send To</button>
            </div>
             <!-- status btn container end-->

            <div id="updatestatus" style="display: none;">
            <form>
              <div class="row user-form">
                <div class="col-sm-6 user-record-form">
               <label class="form-label">Send to Date</label>
                  <input type="date" id="send_to_date" class="form-control" placeholder="Enter your Send to Date">
                </div>
                <div class="col-sm-6 user-record-form">
                      <label class="form-label">Received Back Date</label>
                  <input type="date" id="received_back_office" class="form-control" placeholder="Enter your Received Back Date">
                </div>
              </div>
              <div class="row user-form">
                <div class="col-sm-6 user-record-form">
               <label class="form-label">Remark</label>
                  <input type="text" id="remark1" class="form-control" placeholder="Enter your Remark">
                </div> 
              </div>
              <div class="container">
                <div class="button-container">
                  <button type="button" onclick="Submit1()" class="btn btn-primary">Save</button>                 
                  <button type="button" class="btn btn-primary" onclick="document.getElementById('updatestatus').style.display = 'none'">Cancel</button>
                </div>
              </div>
              </form>
              </div>

              <hr>

              
            <div id="sendtoperson" style="display: none;">
              <form>
                <div class="row user-form">
                  <div class="col-sm-6 user-record-form">
                 <label class="form-label">Send to</label>
                 <select class="form-select" id="designationdd" style="display: none;"></select>
                    <select class="form-select" id="divisiondd"></select>
                  </div>
                  <div class="col-sm-6 user-record-form">
                        <label class="form-label">Remarks</label>
                    <input type="text" id="remarks" class="form-control" id="" placeholder="Enter Remarks">
                  </div>
                </div>
                <div class="container">
                  <div class="button-container">
                    <button type="button" onclick="Submit2()" class="btn btn-primary">Save</button>                 
                    <button type="button" class="btn btn-primary" onclick="document.getElementById('sendtoperson').style.display = 'none'">Cancel</button>
                  </div>
                </div>
              </form>
                </div>
  
<div id="list"></div>
      
      
        </div>


      
    </div>
    <script>

      console.log("************")
          
          let req = new XMLHttpRequest();
          req.open("GET", "http://localhost:8080/ViewFileDiaryEntry/"+sessionStorage.getItem("Id"));
          req.setRequestHeader('Authorization', 'Bearer '+sessionStorage.getItem("token"));
          req.setRequestHeader('Access-Control-Allow-Origin', "*");
          req.send();
          req.onload = () =>
        {
          console.log(request);
          if(req.status == 200)
          {
            const jsonData = JSON.parse(req.response);
            console.log(jsonData);
                  // var formatRecievedDate = new Date(jsonData.received_date);
                  // var formatFileDate = Date.parse(jsonData.file_date);
                  const fileData = jsonData.filediary;
                  document.getElementById("id").value = fileData.id;
                  document.getElementById("newFileNo").value = fileData.file_no;
                  document.getElementById("referenceNo").value = fileData.reference_no;
                  document.getElementById("recievedFrom").value = fileData.received_from;
                  document.getElementById("subject").value = fileData.subject;
                  document.getElementById("recievedDate").value = fileData.received_date;
                  document.getElementById("fileDate").value = fileData.file_date;
                  // const sendTo = fileData.send_to;
                  // const myArray = sendTo.split("|");
                  document.getElementById("designation").value = fileData.send_to_designation;
                  document.getElementById("division").value = fileData.send_to_division;
                  document.getElementById("remark").value = fileData.remarks;
      
                  const filemovementData = jsonData.filemovementhistory;
                  var text = "";
                  for(let i =0; i<filemovementData.length; i++)
                  {
                      console.log("lettermovementData.send_date :" +filemovementData[i].send_date)
                      if(filemovementData[i].send_date == null)
                      {
                          text += "<div class='row user-form'><div class='col-sm-6 user-record-form'><label class='form-label'>Send to:</label>"
                                +"<label class='form-label'>"+filemovementData[i].send_to_division+"</label></div><div class='col-sm-6 user-record-form'>"
                                +"<label class='form-label'>Remarks:</label><label class='form-label'>"+filemovementData[i].remarks+"</label>"
                                +"</div></div><hr>";
                      }
                      else
                      {
                          text += "<div class='row user-form'><div class='col-sm-6 user-record-form'><label class='form-label'>Send to Date:</label>"
                              +"<label class='form-label'> "+filemovementData[i].send_date+"</label></div><div class='col-sm-6 user-record-form'>"
                              +"<label class='form-label'>Received Back Date:</label><label class='form-label'>"+filemovementData[i].received_date+"</label>"
                              +"</div></div><div class='row user-form'><div class='col-sm-6 user-record-form'><label class='form-label'>Remarks:</label>"
                              +"<label class='form-label'>"+filemovementData[i].remarks+"</label></div></div><hr>"
                      }
                      console.log("text :"+text)
                      document.getElementById("list").innerHTML = text;
                  }
      
              }
              else
              {
                  window.location = "loginpage.html"
              }
          }
      
          async function Submit1()
        {
          console.log("************")
          event.preventDefault()
          const id = document.getElementById("id").value;
          const send_to_date = document.getElementById("send_to_date").value;
          const received_back_office = document.getElementById("received_back_office").value;
          const remark1 = document.getElementById("remark1").value;
          const messageReponse = document.getElementById("messageReponse");
          // console.log(formatRecievedDate+"|"+formatFileDate+"|"+recievedDate+"|"+fileDate)
        
          var xhr = new XMLHttpRequest();
          xhr.open('POST', 'http://localhost:8080/sendFileMovementData', true);
          xhr.setRequestHeader('Content-Type', 'application/json');
          xhr.setRequestHeader('Authorization', 'Bearer '+sessionStorage.getItem("token"));
          xhr.onreadystatechange = function() {
              if(xhr.readyState === XMLHttpRequest.DONE) {
                  if(xhr.status === 200) 
                  {
                      let reponse = xhr.responseText;
                      const myArray = reponse.split("|");
                      console.log(myArray[0]+"|"+myArray[1])
                      if(myArray[0] == "200")
                      {
                        window.location = "viewFileDiary.html";
                        messageReponse.textContent = myArray[1];
                        messageReponse.style.color = "green"; 
                      }
                      else
                      {
                        messageReponse.textContent = myArray[1];
                        messageReponse.style.color = "red"; 
                      }
                  }
                  else 
                  {
                      document.getElementById("messageReponse").innerHTML = "Something went wrong, please try after sometime";
                      console.error(xhr.responseText);
                  }
              }
          };
      
      var data = {
        file_id: id,
        send_date: send_to_date,
        received_date: received_back_office,
        remarks: remark1
      };
      
      xhr.send(JSON.stringify(data))
      
        }
      
        async function Submit2()
        {
          console.log("************")
          event.preventDefault()
          const id = document.getElementById("id").value;
          const send_to = document.getElementById("divisiondd").value;
          const remarks = document.getElementById("remarks").value;
          const messageReponse = document.getElementById("messageReponse");
          // console.log(formatRecievedDate+"|"+formatFileDate+"|"+recievedDate+"|"+fileDate)
        
          var xhr = new XMLHttpRequest();
          xhr.open('POST', 'http://localhost:8080/sendFileMovementData', true);
          xhr.setRequestHeader('Content-Type', 'application/json');
          xhr.setRequestHeader('Authorization', 'Bearer '+sessionStorage.getItem("token"));
          xhr.onreadystatechange = function() {
              if(xhr.readyState === XMLHttpRequest.DONE) {
                  if(xhr.status === 200) 
                  {
                      let reponse = xhr.responseText;
                      const myArray = reponse.split("|");
                      console.log(myArray[0]+"|"+myArray[1])
                      if(myArray[0] == "200")
                      {
                        window.location = "viewFileDiary.html";
                        messageReponse.textContent = myArray[1];
                        messageReponse.style.color = "green"; 
                      }
                      else
                      {
                        messageReponse.textContent = myArray[1];
                        messageReponse.style.color = "red"; 
                      }
                  }
                  else 
                  {
                      document.getElementById("messageReponse").innerHTML = "Something went wrong, please try after sometime";
                      console.error(xhr.responseText);
                  }
              }
          };
      
      var data = {
        file_id: id,
        send_to_division: send_to,
        remarks: remarks
      };
      
      xhr.send(JSON.stringify(data))
        }
      </script>
    
    </body>
    </html>
    