<!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
      <link rel="stylesheet" href="style.css">
      <script src="./js/index.js"></script>
    </head>
    <body class="loginpage">
        <div id="loading"></div>
    
      <!-- Main container -->
<div class="page-container">
    
  <div class="bloc none full-width-bloc l-bloc " id="bloc-0">
    <div class="container bloc-lg bloc-sm-lg">
      <div class="row">
        <div class="col-12 col-md-2 col-lg-2 heading">
          <a target="_blank"><img style="height: 110px;" src="img/CSIR-Logo-With-Tagline-Seleceted-Bilingual-01.png" class="img-fluid float-lg-none" alt="CSIR Logo-With-Tagline-Seleceted-Bilingual-01" /></a>
        </div>
        <div class="col-12 offset-lg--1 col-lg-8 col-md-8 heading" id="heading">
          <h5 class="text-lg-center tc-black text-md-center">
            वैज्ञानिक तथा औद्योगिक अनुसंधान परिषद्</h5>
            <h5 class="text-lg-center tc-black text-md-center">
            Council of Scientific and Industrial Research</h5>
            <h5 class="text-lg-center tc-black text-md-center" id="heading2">
            विज्ञान और प्रौद्योगिकी मंत्रालय</h5>
            <h5 class="text-lg-center tc-black text-md-center" id="heading2">
            Ministry of Science and Technology, Govt. of India</h5>
        </div>
        <div class="col-12 col-lg-2 col-md-2 heading">
          <a target="_blank"><img  src="img/G20%20theme%20and%20logo.png" class="img-fluid img-style float-lg-right" alt="G20%20theme%20and%20logo" /></a>
        </div>
      </div>
    </div>
  </div>
  <!-- bloc-0 END -->
  
  <!-- Header start -->
  <nav style="height: 35px;">
      <div class="nav-adj"></div>
      <ul class="navbar" id="navbar">
      </ul>
    </nav>
  
  <!-- bloc-0 END -->
    
    
    <div class="container mt-3">
      <div class="form-header-bg">
        <h2 class="form-header">Update Letter Diary</h2>
      </div>
      <form>
        <div><span id="messageReponse" ></span></div>
        <div class="row user-form">
          <div class="col-sm-6 user-record-form">
         <label class="form-label">New Letter Number</label>
            <input type="text" id="newletter_no" class="form-control" placeholder="Enter your New Letter Number">
          </div>
          <div class="col-sm-6 user-record-form">
                <label class="form-label">Received From</label>
            <select id="recievedFrom" class="form-select"></select>
          </div>
        </div>

        <div class="row">
          <div class="col-sm-6 user-record-form">
         <label class="form-label">Reference Number</label>
         <input type="text" id="reference_no" class="form-control" placeholder="Enter your Reference Number">
          </div>
          <div class="col-sm-6 user-record-form">
                <label class="form-label">Subject</label>
            <input type="text" id="subject" class="form-control" placeholder="Enter your Subject">
          </div>
        </div>
        <div class="row user-form">
            <div class="col-sm-6 user-record-form">
           <label class="form-label">Received Date</label>
              <input type="date" id="recieved_date" class="form-control" placeholder="Enter your Received Date">
            </div>
             <div class="col-sm-6 user-record-form delivary-mode" >
                  <label class="form-label">Letter Date</label>
                  <input type="Date" id="letter_date" class="form-control" placeholder="Enter your Letter Date">
            </div>
          </div>

          <div class="row user-form">
            <div class="col-sm-6 user-record-form">
           <label class="form-label">Send Date</label>
              <input type="date" id="send_date" class="form-control" placeholder="Enter your Send Date">
            </div>
            <div class="col-sm-6 user-record-form">
                <label class="form-label">Send To</label>
                  <select name="" class="form-select" id="designationdd">
                  </select>
            </div>
          </div>

          <div class="row user-form">
            <div class="col-sm-6 user-record-form">
           
            </div>
            <div class="col-sm-6 user-record-form">
                <label class="form-label"></label>
                  <select class="form-select" id="divisiondd">                       
                  </select>
            </div>
          </div>

          <div class="row user-form">
            <div class="col-sm-6 user-record-form">
           <label class="form-label">Diary Date</label>
           <input type="date" id="dairy_date" class="form-control" placeholder="Enter your Diary Date">
              
           </div>
            <div class="col-sm-6 user-record-form">
            <label class="form-label">Form of Communication</label>
            <input type="text" id="formof_communicaition" class="form-control" placeholder="Enter your Form of Communication">

            </div>
          </div>
          <div class="row user-form">
            <div class="col-sm-6 user-record-form">
           <label class="form-label">Language</label>
              <select class="form-select" name="language" id="language">
                <option value="English">English</option>
                <option value="Hindi">Hindi</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="col-sm-6 user-record-form">
                  <label class="form-label">Remark</label>
              <input type="text" id="remarks" class="form-control" placeholder="Enter your Remark">
            </div>
          </div>

          <div class="row user-form">
            <div class="col-sm-6 user-record-form">
           <label class="form-label">VIP</label>
           <select name="state" class="form-select" id="vip-dd">
            <option value="" selected>Select</option>
            <option value="Yes">Yes</option>
            <option value="No">No</option>                
           </select>
            </div>
          </div>

              <div class="container mt-3">
                <div class="form-header-bg">
                  <h2 class="form-header">Contact Details</h2>
              </div>
                <form>
                  <div class="row user-form">
                      <div class="col-sm-6 user-record-form">
                     <label class="form-label">Name</label>
                        <input type="text" id="name" class="form-control" placeholder="Enter your Name">
                      </div>
                      <div class="col-sm-6 user-record-form">
                            <label class="form-label">Designation</label>
                        <input type="text" id="designation" class="form-control" placeholder="Enter your Designation">
                      </div>
                    </div>
                    <div class="row user-form">
                      <div class="col-sm-6 user-record-form">
                     <label class="form-label">Organisation</label>
                        <input type="text" id="organisation" class="form-control" placeholder="Enter your Organisation">
                      </div>
                      <div class="col-sm-6 user-record-form">
                            <label class="form-label">Mobile No.</label>
                        <input type="text" id="mobile_no" class="form-control" placeholder="Enter your Mobile No.">
                      </div>
                    </div>
                    <div class="row user-form">
                      <div class="col-sm-6 user-record-form">
                     <label class="form-label">Email</label>
                        <input type="text" id="email" class="form-control" placeholder="Enter your Email">
                      </div>
                      <div class="col-sm-6 user-record-form">
                            <label class="form-label">Address</label>
                        <input type="text" id="address" class="form-control" placeholder="Enter your Address">
                      </div>
                    </div>
                    <div class="row user-form">
                      <div class="col-sm-6 user-record-form">
                        <label class="form-label">Country</label>
                        <select class="form-select" name="country" id="country">
                          <option value=""disabled selected> -- Select --</option>
                          <option value="option1">India</option>
                          <option value="option2">Other</option>
                        </select>
                      </div>
                      <div class="col-sm-6 user-record-form">
                        <label class="form-label">state</label>
                        <select class="form-select" name="state" id="state">
                              <option value=""disabled selected> -- Select --</option>
                              <option value="Andhra Pradesh">Andhra Pradesh</option>
                              <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                              <option value="Assam">Assam</option>
                              <option value="Bihar">Bihar</option>
                              <option value="Chhattisgarh">Chhattisgarh</option>
                              <option value="Delhi">Delhi</option>
                              <option value="Goa">Goa</option>
                              <option value="Gujarat">Gujarat</option>
                              <option value="Haryana">Haryana</option>
                              <option value="Himachal Pradesh">Himachal Pradesh</option>
                              <option value="Jharkhand">Jharkhand</option>
                              <option value="Karnataka">Karnataka</option>
                              <option value="Kerala">Kerala</option>
                              <option value="Madhya Pradesh">Madhya Pradesh</option>
                              <option value="Maharashtra">Maharashtra</option>
                              <option value="Manipur">Manipur</option>
                              <option value="Meghalaya">Meghalaya</option>
                              <option value="Mizoram">Mizoram</option>
                              <option value="Nagaland">Nagaland</option>
                              <option value="Odisha">Odisha</option>
                              <option value="Punjab">Punjab</option>
                              <option value="Rajasthan">Rajasthan</option>
                              <option value="Sikkim">Sikkim</option>
                              <option value="Tamil Nadu">Tamil Nadu</option>
                              <option value="Telangana">Telangana</option>
                              <option value="Tripura">Tripura</option>
                              <option value="Uttar Pradesh">Uttar Pradesh</option>
                              <option value="Uttarakhand">Uttarakhand</option>
                              <option value="West Bengal">West Bengal</option>
  
                              </select>  
                      </div>
                    </div>
                    <div class="row user-form">
                      <div class="col-sm-6 user-record-form">
                        <label class="form-label">city</label>
                            <input type="text" id="city" class="form-control" placeholder="Enter your city">
                      </div>
                      <div class="col-sm-6 user-record-form">
                        <label class="form-label">Pin code</label>
                        <input type="text" id="pin_code" class="form-control" placeholder="Enter your Pin code">
                      </div>
                    </div>
                    <div class="row user-form">
                      <div class="col-sm-6 user-record-form">
                        <label class="form-label">Landline</label>
                        <input type="text" id="landline" class="form-control" placeholder="Enter your Landline">
                      </div>
                      <div class="col-sm-6 user-record-form">
                        <label class="form-label">Fax</label>
                        <input type="text" id="fax" class="form-control" placeholder="Enter your Fax">
                      </div>
                    </div>
              </form>



              </div>






              <div class="container">
            
                <div class="button-container">
                  <button type="button" onclick="Edit()" class="btn btn-primary">Update</button>
                  
                    <button type="button" class="btn btn-primary" onclick="history.go(-1)">Cancel</button>
                  
                </div>
              </div>

              <!-- <h2 class="user-record-title">Editable</h2> -->
          </div>
  
        
      </div>
  <script>
    let req = new XMLHttpRequest();
    req.open("GET", "http://localhost:8080/ViewLetterDiaryEntry/"+sessionStorage.getItem("Id"));
    req.setRequestHeader('Authorization', 'Bearer '+sessionStorage.getItem("token"));
    req.setRequestHeader('Access-Control-Allow-Origin', "*");
	  req.send();
    req.onload = () =>
	{
		console.log(req);
		if(req.status == 200)
		{
			const jsonData = JSON.parse(req.response);
			console.log(jsonData);
            const letterData = jsonData.letterdiary;
            const sendTo = letterData.cdt;
            const myArray = sendTo.split("T");
                console.log(myArray[0]+"|"+myArray[1])
            document.getElementById("newletter_no").value = letterData.letter_number;
            document.getElementById("recievedFrom").value = letterData.received_from;
            document.getElementById("reference_no").value = letterData.refrence_no;
            document.getElementById("letter_date").value = letterData.letter_date;
            document.getElementById("subject").value = letterData.subject;
            document.getElementById("recieved_date").value = letterData.received_date;
            document.getElementById("send_date").value = myArray[0];
            document.getElementById("designationdd").value = letterData.send_to_designation;
            document.getElementById("divisiondd").value = letterData.send_to_division;
            document.getElementById("dairy_date").value = letterData.diary_date;
            document.getElementById("formof_communicaition").value = letterData.form_of_communication;
            document.getElementById("language").value = letterData.language;
            document.getElementById("remarks").value = letterData.remarks;
            document.getElementById("vip-dd").value = letterData.vip;
            
            const contactData = jsonData.contactdetails;
            document.getElementById("name").value = contactData.name;
            document.getElementById("designation").value = contactData.designation;
            document.getElementById("organisation").value = contactData.organisation;
            document.getElementById("mobile_no").value = contactData.mobileno;
            document.getElementById("email").value = contactData.email;
            document.getElementById("address").value = contactData.address;
            document.getElementById("country").value = contactData.country;
            document.getElementById("state").value = contactData.state;
            document.getElementById("city").value = contactData.city;
            document.getElementById("pin_code").value = contactData.pincode;
            document.getElementById("landline").value = contactData.landline;
            document.getElementById("fax").value = contactData.fax;
        }
        else
        {
            window.location = "loginpage.html"
        }
    }

  async function Edit()
  {
    console.log("************")
    event.preventDefault()
    const newletter_no = document.getElementById("newletter_no").value;
    const received_from = document.getElementById("recievedFrom").value;
    const reference_no = document.getElementById("reference_no").value;
    const letter_date = document.getElementById("letter_date").value;
    const subject = document.getElementById("subject").value;
    const recieved_date = document.getElementById("recieved_date").value;
    const send_date = document.getElementById("send_date").value;
    const send_to = document.getElementById("designationdd").value;
    const div_name = document.getElementById("divisiondd").value;
    const dairy_date = document.getElementById("dairy_date").value;
    const formof_communicaition = document.getElementById("formof_communicaition").value;
    const language = document.getElementById("language").value;
    const remarks = document.getElementById("remarks").value;
    const vip = document.getElementById("vip-dd").value;
    
    var formatletter_date = new Date(letter_date);
    var formatrecieved_date = new Date(recieved_date);
    var formatsend_date = new Date(send_date);
    var formatdairy_date = new Date(dairy_date);

    const name = document.getElementById("name").value;
    const designation = document.getElementById("designation").value;
    const organisation = document.getElementById("organisation").value;
    const mobile_no = document.getElementById("mobile_no").value;
    const email = document.getElementById("email").value;
    const address = document.getElementById("address").value;
    const country = document.getElementById("country").value;
    const state = document.getElementById("state").value;
    const city = document.getElementById("city").value;
    const pin_code = document.getElementById("pin_code").value;
    const landline = document.getElementById("landline").value;
    const fax = document.getElementById("fax").value;

    const messageReponse = document.getElementById("messageReponse");

    var xhr = new XMLHttpRequest();
    xhr.open('PUT', 'http://localhost:8080/editletterdiary/'+ sessionStorage.getItem("Id"), true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.setRequestHeader('Authorization', 'Bearer '+sessionStorage.getItem("token"));
    xhr.setRequestHeader('Access-Control-Allow-Origin', "*");
    xhr.onreadystatechange = function() {
        if(xhr.readyState === XMLHttpRequest.DONE) {
            if(xhr.status === 200) {
                let reponse = xhr.responseText;
                const myArray = reponse.split("|");
                console.log(myArray[0]+"|"+myArray[1])
                if(myArray[0] == "200")
                {
                  messageReponse.textContent = myArray[1];
                  messageReponse.style.color = "green"; 
                  window.location = "letterListPage.html";
                }
                else
                {
                  messageReponse.textContent = '* '+myArray[1];
                  messageReponse.style.color = "red"; 
                }
            }
            else {
                messageReponse.textContent = "** Something went wrong, please try after sometime";
                messageReponse.style.color = "red"; 
                console.error(xhr.responseText);
            }
        }
    };

    var data = {
      letterDiary: {
        letter_number: newletter_no,
        received_from: received_from,
        refrence_no: reference_no,
        // letter_date : formatletter_date.toLocaleString('default', { day: '2-digit' })+'-'+formatletter_date.toLocaleString('default', { month: '2-digit' })+'-'+formatletter_date.toLocaleString('default', { year: 'numeric' }),
        letter_date: letter_date,
        subject: subject,
        received_date: recieved_date,
        cdt: send_date,
        send_to_designation: send_to,
        send_to_division: div_name,
        diary_date: dairy_date,
        form_of_communication: formof_communicaition,
        language: language,
        remarks: remarks,
        vip: vip
      },
      contactDetails:{
        name: name,
        designation: designation,
        organisation: organisation,
        mobileno: mobile_no,
        email: email,
        address: address,
        country: country,
        state: state,
        city: city,
        pincode: pin_code,
        landline: landline,
        fax: fax
      }
  };

  xhr.send(JSON.stringify(data))
  // window.location = "filediarysystemtable.html";
  }
  </script>
      
      </body>
      </html>
      